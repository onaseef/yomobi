define(["aloha/ecma5shims","aloha/jquery"],function(e,t){function o(e){if(!e)return 0;if(!e.style)return 0;if(typeof e.style.length!="undefined")return e.style.length;var t=0;for(var n in e.style)e.style[n]&&e.style[n]!==0&&e.style[n]!=="false"&&t++;return t}function u(e){if(!e)return null;var t=[],n,r=e.length;for(n=r>>>0;n--;)t[n]=e[n];return t}function a(e){return e.hasChildNodes()?e.firstChild:l(e)}function f(t){if(t.previousSibling){t=t.previousSibling;while(t.hasChildNodes())t=t.lastChild;return t}return t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE?t.parentNode:null}function l(e){while(e&&!e.nextSibling)e=e.parentNode;return e?e.nextSibling:null}function c(t,n){return t&&n&&Boolean(e.compareDocumentPosition(t,n)&e.Node.DOCUMENT_POSITION_CONTAINED_BY)}function h(e,t){return(e||t)&&(e==t||c(e,t))}function p(t,n){return n&&t&&Boolean(e.compareDocumentPosition(n,t)&e.Node.DOCUMENT_POSITION_CONTAINED_BY)}function d(t,n){return Boolean(e.compareDocumentPosition(t,n)&e.Node.DOCUMENT_POSITION_FOLLOWING)}function v(t,n){return Boolean(e.compareDocumentPosition(t,n)&e.Node.DOCUMENT_POSITION_PRECEDING)}function m(e){var t=[];while(e.parentNode)t.unshift(e.parentNode),e=e.parentNode;return t}function g(e){var t=[],n=l(e);while((e=a(e))&&e!=n)t.push(e);return t}function y(e){var t={fontFamily:"font-family",fontSize:"font-size",fontStyle:"font-style",fontWeight:"font-weight",textDecoration:"text-decoration"};return typeof t[e]!="undefined"?t[e]:e}function b(e){return{"xx-small":1,small:2,medium:3,large:4,"x-large":5,"xx-large":6,"xxx-large":7}[e]}function w(e){return{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[e]}function E(e){return e===null||!e||e===n}function S(e){return e.dir=="ltr"?"ltr":e.dir=="rtl"?"rtl":q(e.parentNode)?S(e.parentNode):"ltr"}function x(e){var t=0;while(e.previousSibling)t++,e=e.previousSibling;return t}function T(t){switch(t.nodeType){case e.Node.PROCESSING_INSTRUCTION_NODE:case e.Node.DOCUMENT_TYPE_NODE:return 0;case e.Node.TEXT_NODE:case e.Node.COMMENT_NODE:return t.length;default:return t.childNodes.length}}function N(t,n,r,i){if(t==r){if(n==i)return"equal";if(n<i)return"before";if(n>i)return"after"}if(e.compareDocumentPosition(r,t)&e.Node.DOCUMENT_POSITION_FOLLOWING){var s=N(r,i,t,n);if(s=="before")return"after";if(s=="after")return"before"}if(e.compareDocumentPosition(r,t)&e.Node.DOCUMENT_POSITION_CONTAINS){var o=r;while(o.parentNode!=t)o=o.parentNode;if(x(o)<n)return"after"}return"before"}function C(e){var t=e;while(t.parentNode!=null)t=t.parentNode;return t}function k(e,t){var n=N(e,0,t.startContainer,t.startOffset),r=N(e,T(e),t.endContainer,t.endOffset);return C(e)==C(t.startContainer)&&n=="after"&&r=="before"}function L(e,t){typeof t=="undefined"&&(t=function(){return!0});var n=e.startContainer;n.hasChildNodes()&&e.startOffset<n.childNodes.length?n=n.childNodes[e.startOffset]:e.startOffset==T(n)?n=l(n):n=a(n);var r=e.endContainer;r.hasChildNodes()&&e.endOffset<r.childNodes.length?r=r.childNodes[e.endOffset]:r=l(r);var i=[];while(d(n,r)){if(k(n,e)&&t(n)){i.push(n),n=l(n);continue}n=a(n)}return i}function A(e,t){typeof t=="undefined"&&(t=function(){return!0});var n=e.startContainer;n.hasChildNodes()&&e.startOffset<n.childNodes.length?n=n.childNodes[e.startOffset]:e.startOffset==T(n)?n=l(n):n=a(n);var r=e.endContainer;r.hasChildNodes()&&e.endOffset<r.childNodes.length?r=r.childNodes[e.endOffset]:r=l(r);var i=[];while(d(n,r))k(n,e)&&t(n)&&i.push(n),n=a(n);return i}function O(t){if(t.toLowerCase()=="currentcolor")return null;var n=document.createElement("span");document.body.appendChild(n),n.style.color="black";var r=document.createElement("span");n.appendChild(r),r.style.color=t,t=e.getComputedStyle(r).color;if(t=="rgb(0, 0, 0)"){n.color="white",t=e.getComputedStyle(r).color;if(t!="rgb(0, 0, 0)")return null}return document.body.removeChild(n),/^rgba\([0-9]+, [0-9]+, [0-9]+, 1\)$/.test(t)?t.replace("rgba","rgb").replace(", 1)",")"):t=="transparent"?"rgba(0, 0, 0, 0)":t}function M(t){t=t.toLowerCase();if(e(["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]).indexOf(t)!=-1)return t;t=O(t);var n=/^rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)$/.exec(t);return n?"#"+parseInt(n[1]).toString(16).replace(/^.$/,"0$&")+parseInt(n[2]).toString(16).replace(/^.$/,"0$&")+parseInt(n[3]).toString(16).replace(/^.$/,"0$&"):null}function D(e,t,n,r){_==0&&typeof n!="undefined"?i=n:_==0&&(i=null,i=n);if(e in s){if(t=="enabled"||t in s[e]){_++;try{var o=r()}catch(u){throw _--,u}return _--,o}throw"INVALID_ACCESS_ERR"}throw"NOT_SUPPORTED_ERR"}function P(e,t,n,r){e=e.toLowerCase();if(arguments.length==1||arguments.length>=4&&typeof t=="undefined")t=!1;if(arguments.length<=2||arguments.length>=4&&typeof n=="undefined")n="";return D(e,"action",r,function(e,t,n){return function(){return H(e)?(s[e].action(n,r),it(r),!0):!1}}(e,t,n))}function H(t,n){return t=t.toLowerCase(),D(t,"action",n,function(t){return function(){return e(["copy","cut","paste","selectall","stylewithcss","usecss"]).indexOf(t)!=-1||n!==null}}(t))}function B(e,t){return e=e.toLowerCase(),D(e,"indeterm",t,function(e){return function(){return H(e,t)?s[e].indeterm(t):!1}}(e))}function j(e,t){return e=e.toLowerCase(),D(e,"state",t,function(e){return function(){return H(e,t)?typeof ot(e,t)!="undefined"?ot(e,t):s[e].state(t):!1}}(e))}function F(e){return e=e.toLowerCase(),e in s}function I(e,t){return e=e.toLowerCase(),D(e,"value",t,function(){return H(e,t)?e=="fontsize"&&ft("fontsize",t)!==undefined?Ft(ft("fontsize",t)):typeof ft(e,t)!="undefined"?ft(e,t):s[e].value():""})}function q(t,n){return typeof n=="string"&&(n=[n]),typeof n=="object"&&(n=e(n).map(function(e){return e.toUpperCase()})),t&&t.nodeType==e.Node.ELEMENT_NODE&&E(t.namespaceURI)&&(typeof n=="undefined"||e(n).indexOf(t.tagName)!=-1)}function U(e){return q(e,R)}function z(t){return t&&(t.nodeType==e.Node.ELEMENT_NODE&&e(["inline","inline-block","inline-table","none"]).indexOf(e.getComputedStyle(t).display)==-1||t.nodeType==e.Node.DOCUMENT_NODE||t.nodeType==e.Node.DOCUMENT_FRAGMENT_NODE)}function W(e){return e&&!z(e)}function X(t){return t&&t.nodeType==e.Node.ELEMENT_NODE&&(t.contentEditable=="true"||t.parentNode&&t.parentNode.nodeType==e.Node.DOCUMENT_NODE&&t.parentNode.designMode=="on")}function V(n){return n&&!X(n)&&(n.nodeType!=e.Node.ELEMENT_NODE||n.contentEditable!="false"||t(n).hasClass("aloha-table-wrapper"))&&(X(n.parentNode)||V(n.parentNode))}function $(e){for(var t=0;t<e.childNodes.length;t++)if(V(e.childNodes[t])||$(e.childNodes[t]))return!0;return!1}function J(e){if(X(e))return e;if(V(e)){var t=e.parentNode;while(!X(t))t=t.parentNode;return t}return null}function K(e,t){return J(e)&&J(e)==J(t)}function Q(t){if(!q(t,"br"))return!1;var n=t.parentNode;while(e.getComputedStyle(n).display=="inline")n=n.parentNode;var r=e(n).hasAttribute("style")?n.getAttribute("style"):null;n.style.height="auto",n.style.maxHeight="none",n.style.minHeight="0";var i=document.createTextNode("​"),s=n.offsetHeight;if(s==0)throw"isCollapsedLineBreak: original height is zero, bug?";t.parentNode.insertBefore(i,t.nextSibling);var o=n.offsetHeight;return i.parentNode.removeChild(i),r===null?(n.setAttribute("style",""),n.removeAttribute("style")):n.setAttribute("style",r),s<o-5}function G(t){if(!q(t,"br"))return!1;if(q(t.parentNode,"li")&&t.parentNode.childNodes.length==1)return!1;var n=t.parentNode;while(e.getComputedStyle(n).display=="inline")n=n.parentNode;var r=e(n).hasAttribute("style")?n.getAttribute("style"):null;n.style.height="auto",n.style.maxHeight="none",n.style.minHeight="0";var i=e(t).hasAttribute("style")?t.getAttribute("style"):null,s=n.offsetHeight;if(s==0)throw"isExtraneousLineBreak: original height is zero, bug?";t.setAttribute("style","display:none");var o=n.offsetHeight;return r===null?(n.setAttribute("style",""),n.removeAttribute("style")):n.setAttribute("style",r),i===null?t.removeAttribute("style"):t.setAttribute("style",i),s==o}function Y(t){return t&&t.nodeType==e.Node.TEXT_NODE&&(t.data==""||/^[\t\n\r ]+$/.test(t.data)&&t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE&&e(["normal","nowrap"]).indexOf(e.getComputedStyle(t.parentNode).whiteSpace)!=-1||/^[\t\r ]+$/.test(t.data)&&t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE&&e.getComputedStyle(t.parentNode).whiteSpace=="pre-line"||/^[\t\n\r ]+$/.test(t.data)&&t.parentNode&&t.parentNode.nodeType==e.Node.DOCUMENT_FRAGMENT_NODE)}function Z(t,n){if(!V(t)&&!X(t))return;if(!t||t.nodeType!==e.Node.TEXT_NODE)return;if(e(["pre","pre-wrap"]).indexOf(e.getComputedStyle(t.parentNode).whiteSpace)!=-1)return;if(!/[\t\n\r ]{2,}/.test(t.data))return;var r="",i=n.startContainer==t,s=n.endContainer==t,o=!1;for(var u=0;u<t.data.length;++u)/[\t\n\r ]/.test(t.data[u])?o?(i&&r.length<n.startOffset&&n.startOffset--,s&&r.length<n.endOffset&&n.endOffset--):(r+=" ",o=!0):(r+=t.data[u],o=!1);t.data=r}function et(t){if(!Y(t))return!1;if(t.data=="")return!0;var n=t.parentNode;if(!n)return!0;if(e(m(t)).some(function(t){return t.nodeType==e.Node.ELEMENT_NODE&&e.getComputedStyle(t).display=="none"}))return!0;while(!z(n)&&n.parentNode)n=n.parentNode;var r=t;while(r!=n){r=f(r);if(z(r)||q(r,"br"))return!0;if(r.nodeType==e.Node.TEXT_NODE&&!Y(r)||q(r,"img"))break}r=t;var i=l(n);while(r!=i){r=a(r);if(z(r)||q(r,"br"))return!0;if(r&&r.nodeType==e.Node.TEXT_NODE&&!Y(r)||q(r,"img"))break}return!1}function tt(t){if(!t)return!1;if(e(m(t).concat(t)).filter(function(t){return t.nodeType==e.Node.ELEMENT_NODE},!0).some(function(t){return e.getComputedStyle(t).display=="none"}))return!1;if(z(t)||t.nodeType==e.Node.TEXT_NODE&&!et(t)||q(t,"img")||q(t,"br")&&!G(t))return!0;for(var n=0;n<t.childNodes.length;n++)if(tt(t.childNodes[n]))return!0;return!1}function nt(e){return e&&!tt(e)}function rt(t){if(Q(t)&&!G(t))return!0;if(!W(t)||t.nodeType!=e.Node.ELEMENT_NODE)return!1;var n=!1;for(var r=0;r<t.childNodes.length;r++){if(!nt(t.childNodes[r])&&!rt(t.childNodes[r]))return!1;rt(t.childNodes[r])&&(n=!0)}return n}function it(e){var t=new window.GENTICS.Utils.RangeObject;t.startContainer=e.startContainer,t.startOffset=e.startOffset,t.endContainer=e.endContainer,t.endOffset=e.endOffset,t.select()}function st(){var t;if(i)t=i;else{if(!Aloha.getSelection().rangeCount)return null;t=Aloha.getSelection().getRangeAt(0)}if(e([e.Node.TEXT_NODE,e.Node.ELEMENT_NODE]).indexOf(t.startContainer.nodeType)==-1||e([e.Node.TEXT_NODE,e.Node.ELEMENT_NODE]).indexOf(t.endContainer.nodeType)==-1||!t.startContainer.ownerDocument||!t.endContainer.ownerDocument||!p(t.startContainer,t.startContainer.ownerDocument)||!p(t.endContainer,t.endContainer.ownerDocument))throw"Invalid active range; test bug?";return t}function ht(t,n,r,i){r==-1&&(r=n.childNodes.length);var s=t.parentNode,o=x(t),u=[i];for(var a=0;a<Aloha.getSelection().rangeCount;a++)u.push(Aloha.getSelection().getRangeAt(a));var f=[];e(u).forEach(function(e){f.push([e.startContainer,e.startOffset]),f.push([e.endContainer,e.endOffset])}),e(f).forEach(function(e){e[0]==n&&e[1]>r&&e[1]++,e[0]==s&&(e[1]==o||e[1]==o+1)&&(e[0]=n,e[1]+=r-o),e[0]==s&&e[1]>o+1&&e[1]--}),n.childNodes.length==r?n.appendChild(t):n.insertBefore(t,n.childNodes[r]);if(f[0][1]>f[0][0].childNodes.length&&f[1][1]>f[1][0].childNodes.length)i.setStart(t,0),i.setEnd(t,0);else{i.setStart(f[0][0],f[0][1]),i.setEnd(f[1][0],f[1][1]),Aloha.getSelection().removeAllRanges();for(var a=1;a<u.length;a++){var l=Aloha.createRange();l.setStart(f[2*a][0],f[2*a][1]),l.setEnd(f[2*a+1][0],f[2*a+1][1]),Aloha.getSelection().addRange(l)}l&&(i=l)}}function pt(e,t,n){if(q(e,t.toUpperCase()))return e;if(!e.parentNode)return e;var r=e.ownerDocument.createElement(t);e.parentNode.insertBefore(r,e);for(var i=0;i<e.attributes.length;i++)typeof r.setAttributeNS=="function"?r.setAttributeNS(e.attributes[i].namespaceURI,e.attributes[i].name,e.attributes[i].value):r.setAttribute(e.attributes[i].name,e.attributes[i].value);while(e.childNodes.length)ht(e.firstChild,r,r.childNodes.length,n);return e.parentNode.removeChild(e),n.startContainer===e&&n.setStart(r,n.startOffset),n.endContainer===e&&n.setEnd(r,n.endOffset),r}function dt(e){var t=e.previousSibling;if(!t)return;while(t.hasChildNodes())t=t.lastChild;while(nt(t)&&!G(t)&&t!=e.parentNode)t=f(t);V(t)&&G(t)&&t.parentNode.removeChild(t)}function vt(e){var t=e;while(t.hasChildNodes())t=t.lastChild;while(nt(t)&&!G(t)&&t!=e)t=f(t);V(t)&&G(t)&&t.parentNode.removeChild(t)}function mt(e){dt(e),vt(e)}function gt(e,t,n,r){typeof t=="undefined"&&(t=function(){return!1}),typeof n=="undefined"&&(n=function(){return null});if(!e.length||!V(e[0]))return null;W(e[e.length-1])&&!q(e[e.length-1],"br")&&q(e[e.length-1].nextSibling,"br")&&e.push(e[e.length-1].nextSibling);var s;V(e[0].previousSibling)&&t(e[0].previousSibling)?s=e[0].previousSibling:V(e[e.length-1].nextSibling)&&t(e[e.length-1].nextSibling)?s=e[e.length-1].nextSibling:s=n();if(!s)return null;if(!s.parentNode){e[0].parentNode.insertBefore(s,e[0]);var o=r.startContainer,u=r.startOffset,a=r.endContainer,f=r.endOffset;o==s.parentNode&&u>=x(s)&&r.setStart(o,u+1),a==s.parentNode&&f>=x(s)&&r.setEnd(a,f+1),i&&i!==r&&(o=i.startContainer,u=i.startOffset,a=i.endContainer,f=i.endOffset,o==s.parentNode&&u>=x(s)&&i.setStart(o,u+1),a==s.parentNode&&f>=x(s)&&i.setEnd(a,f+1))}var l=e[0].parentNode;if(d(s,e[0])){!W(s)&&W(s.lastChild)&&W(e[0])&&!q(s.lastChild,"BR")&&s.appendChild(s.ownerDocument.createElement("br"));for(var c=0;c<e.length;c++)ht(e[c],s,-1,r)}else{!W(s)&&W(s.firstChild)&&W(e[e.length-1])&&!q(e[e.length-1],"BR")&&s.insertBefore(s.ownerDocument.createElement("br"),s.firstChild);for(var c=e.length-1;c>=0;c--)ht(e[c],s,0,r)}V(l)&&!l.hasChildNodes()&&l.parentNode.removeChild(l);if(V(s.nextSibling)&&t(s.nextSibling)){!W(s)&&W(s.lastChild)&&W(s.nextSibling.firstChild)&&!q(s.lastChild,"BR")&&s.appendChild(s.ownerDocument.createElement("br"));while(s.nextSibling.hasChildNodes())ht(s.nextSibling.firstChild,s,-1,r);s.parentNode.removeChild(s.nextSibling)}return mt(s),s}function bt(e){return q(e,yt)}function wt(t,n){if((e(["colgroup","table","tbody","tfoot","thead","tr"]).indexOf(n)!=-1||q(n,["colgroup","table","tbody","tfoot","thead","tr"]))&&typeof t=="object"&&t.nodeType==e.Node.TEXT_NODE&&!/^[ \t\n\f\r]*$/.test(t.data))return!1;if(e(["script","style","plaintext","xmp"]).indexOf(n)==-1&&!q(n,["script","style","plaintext","xmp"])||typeof t=="object"&&t.nodeType==e.Node.TEXT_NODE){if(typeof t!="object"||t.nodeType!=e.Node.DOCUMENT_NODE&&t.nodeType!=e.Node.DOCUMENT_FRAGMENT_NODE&&t.nodeType!=e.Node.DOCUMENT_TYPE_NODE){q(t)&&(t=t.tagName.toLowerCase());if(typeof t!="string")return!0;if(q(n)){var r=n;while(r){if(t=="a"&&q(r,"a"))return!1;if(e(R).indexOf(t)!=-1&&bt(r))return!1;if(/^h[1-6]$/.test(t)&&q(r)&&/^H[1-6]$/.test(r.tagName))return!1;r=r.parentNode}n=n.tagName.toLowerCase()}if(typeof n!="object"||n.nodeType!=e.Node.ELEMENT_NODE&&n.nodeType!=e.Node.DOCUMENT_FRAGMENT_NODE){if(typeof n!="string")return!1;switch(n){case"colgroup":return t=="col";case"table":return e(["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"]).indexOf(t)!=-1;case"tbody":case"thead":case"tfoot":return e(["td","th","tr"]).indexOf(t)!=-1;case"tr":return e(["td","th"]).indexOf(t)!=-1;case"dl":return e(["dt","dd"]).indexOf(t)!=-1;case"dir":case"ol":case"ul":return e(["dir","li","ol","ul"]).indexOf(t)!=-1;case"hgroup":return/^h[1-6]$/.test(t)}if(e(["body","caption","col","colgroup","frame","frameset","head","html","tbody","td","tfoot","th","thead","tr"]).indexOf(t)!=-1)return!1;if(e(["dd","dt"]).indexOf(t)!=-1&&n!="dl")return!1;if(t=="li"&&n!="ol"&&n!="ul")return!1;var i=[[["a"],["a"]],[["dd","dt"],["dd","dt"]],[["h1","h2","h3","h4","h5","h6"],["h1","h2","h3","h4","h5","h6"]],[["li"],["li"]],[["nobr"],["nobr"]],[yt,R],[["td","th"],["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"]]];for(var s=0;s<i.length;s++)if(e(i[s][0]).indexOf(n)!=-1&&e(i[s][1]).indexOf(t)!=-1)return!1;return!0}return!0}return!1}return!1}function Et(t,n){return n.collapsed?!1:k(t,n)?!0:t==n.startContainer&&t.nodeType==e.Node.TEXT_NODE&&T(t)!=n.startOffset?!0:t==n.endContainer&&t.nodeType==e.Node.TEXT_NODE&&n.endOffset!=0?!0:t.hasChildNodes()&&e(t.childNodes).every(function(e){return Et(e,n)})&&(!p(n.startContainer,t)||n.startContainer.nodeType!=e.Node.TEXT_NODE||n.startOffset==0)&&(!p(n.endContainer,t)||n.endContainer.nodeType!=e.Node.TEXT_NODE||n.endOffset==T(n.endContainer))?!0:!1}function St(e,t){typeof t=="undefined"&&(t=function(){return!0});var n=e.startContainer;while(Et(n.parentNode,e))n=n.parentNode;var r=l(e.endContainer),i=[];while(d(n,r)){if(Et(n,e)&&t(n)){i.push(n),n=l(n);continue}n=a(n)}return i}function xt(e,t){typeof t=="undefined"&&(t=function(){return!0});var n=e.startContainer;while(Et(n.parentNode,e))n=n.parentNode;var r=l(e.endContainer),i=[];while(d(n,r))Et(n,e)&&t(n)&&i.push(n),n=a(n);return i}function Tt(t){if(!q(t))return!1;if(e(["B","EM","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"]).indexOf(t.tagName)!=-1){if(t.attributes.length==0)return!0;if(t.attributes.length==1&&e(t).hasAttribute("style"))return!0}if(t.tagName=="FONT"||t.tagName=="A"){var n=t.attributes.length;e(t).hasAttribute("style")&&n--,t.tagName=="FONT"&&(e(t).hasAttribute("color")&&n--,e(t).hasAttribute("face")&&n--,e(t).hasAttribute("size")&&n--),t.tagName=="A"&&e(t).hasAttribute("href")&&n--;if(n==0)return!0}return!1}function Nt(t){return q(t)?e(["A","B","EM","FONT","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"]).indexOf(t.tagName)==-1?!1:t.attributes.length==0?!0:t.attributes.length>1?!1:e(t).hasAttribute("style")&&o(t)==0?!0:t.tagName=="A"&&e(t).hasAttribute("href")?!0:t.tagName=="FONT"&&(e(t).hasAttribute("color")||e(t).hasAttribute("face")||e(t).hasAttribute("size"))?!0:t.tagName!="B"&&t.tagName!="STRONG"||!e(t).hasAttribute("style")||o(t)!=1||t.style.fontWeight==""?t.tagName!="I"&&t.tagName!="EM"||!e(t).hasAttribute("style")||o(t)!=1||t.style.fontStyle==""?t.tagName!="A"&&t.tagName!="FONT"&&t.tagName!="SPAN"||!e(t).hasAttribute("style")||o(t)!=1||t.style.textDecoration!=""?e(["A","FONT","S","SPAN","STRIKE","U"]).indexOf(t.tagName)==-1||!e(t).hasAttribute("style")||o(t)!=1||t.style.textDecoration!="line-through"&&t.style.textDecoration!="underline"&&t.style.textDecoration!="overline"&&t.style.textDecoration!="none"?!1:!0:!0:!0:!0:!1}function Ct(e,t,n){return t===null&&n===null?!0:typeof t!="string"||typeof n!="string"||t!=n||"equivalentValues"in s[e]?typeof t=="string"&&typeof n=="string"&&"equivalentValues"in s[e]&&s[e].equivalentValues(t,n)?!0:!1:!0}function kt(t,n,r){if(Ct(t,n,r))return!0;if(t!="fontsize"||typeof n!="string"||typeof r!="string")return!1;var i=kt;if(i.sizeMap===undefined){i.sizeMap={};var s=document.createElement("font");document.body.appendChild(s),e(["xx-small","small","medium","large","x-large","xx-large","xxx-large"]).forEach(function(t){s.size=b(t),i.sizeMap[t]=e.getComputedStyle(s).fontSize}),document.body.removeChild(s)}return n===i.sizeMap[r]||r===i.sizeMap[n]}function Lt(t,n){if(t.nodeType==e.Node.ELEMENT_NODE||!!t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE){if(t.nodeType!=e.Node.ELEMENT_NODE)return Lt(t.parentNode,n);if(n=="createlink"||n=="unlink"){while(t&&(!q(t)||t.tagName!="A"||!e(t).hasAttribute("href")))t=t.parentNode;return t?t.getAttribute("href"):null}if(n=="backcolor"||n=="hilitecolor"){while((e.getComputedStyle(t).backgroundColor=="rgba(0, 0, 0, 0)"||e.getComputedStyle(t).backgroundColor===""||e.getComputedStyle(t).backgroundColor=="transparent")&&t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE)t=t.parentNode;return e.getComputedStyle(t).backgroundColor=="rgba(0, 0, 0, 0)"||e.getComputedStyle(t).backgroundColor===""||e.getComputedStyle(t).backgroundColor=="transparent"?"rgb(255, 255, 255)":e.getComputedStyle(t).backgroundColor}if(n=="subscript"||n=="superscript"){var r=!1,i=!1;while(W(t)){var o=e.getComputedStyle(t).verticalAlign;q(t,"sub")?r=!0:q(t,"sup")&&(i=!0),t=t.parentNode}return r&&i?"mixed":r?"subscript":i?"superscript":null}if(n=="strikethrough"){do{if(e.getComputedStyle(t).textDecoration.indexOf("line-through")!=-1)return"line-through";t=t.parentNode}while(t&&t.nodeType==e.Node.ELEMENT_NODE);return null}if(n=="underline"){do{if(e.getComputedStyle(t).textDecoration.indexOf("underline")!=-1)return"underline";t=t.parentNode}while(t&&t.nodeType==e.Node.ELEMENT_NODE);return null}if("relevantCssProperty"in s[n])return e.getComputedStyle(t)[s[n].relevantCssProperty].toString();throw"Bug: no relevantCssProperty for "+n+" in getEffectiveCommandValue"}return null}function At(t,n){if(n!="backcolor"&&n!="hilitecolor"||e.getComputedStyle(t).display=="inline"){if(n=="createlink"||n=="unlink")return q(t)&&t.tagName=="A"&&e(t).hasAttribute("href")?t.getAttribute("href"):null;if(n=="subscript"||n=="superscript")return q(t,"sup")?"superscript":q(t,"sub")?"subscript":null;if(n=="strikethrough"&&t.style.textDecoration!="")return t.style.textDecoration.indexOf("line-through")!=-1?"line-through":null;if(n=="strikethrough"&&q(t,["S","STRIKE"]))return"line-through";if(n=="underline"&&t.style.textDecoration!="")return t.style.textDecoration.indexOf("underline")!=-1?"underline":null;if(n=="underline"&&q(t,"U"))return"underline";var r=s[n].relevantCssProperty;if(r===null)return null;if(t.style[r]!="")return t.style[r];if(E(t.namespaceURI)&&t.tagName=="FONT"){if(r=="color"&&e(t).hasAttribute("color"))return t.color;if(r=="fontFamily"&&e(t).hasAttribute("face"))return t.face;if(r=="fontSize"&&e(t).hasAttribute("size")){var i=parseInt(t.size);return i<1&&(i=1),i>7&&(i=7),{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[i]}}return r!="fontWeight"||t.tagName!="B"&&t.tagName!="STRONG"?r!="fontStyle"||t.tagName!="I"&&t.tagName!="EM"?null:"italic":"bold"}return null}function Ot(e,t,n,r){var i=e;while(Tt(i)&&i.childNodes.length==1&&Tt(i.firstChild)&&(!Nt(i)||!Ct(t,At(i,t),n)))i=i.firstChild;if(i==e||!Nt(i)||!Ct(t,At(i,t),n)||!kt(t,Lt(i,t),n))return;while(i.hasChildNodes())ht(i.firstChild,i.parentNode,x(i),r);e.parentNode.insertBefore(i,e.nextSibling),ht(e,i,-1,r)}function Mt(t){var n=[];return e(t).forEach(function(t){e(["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"]).forEach(function(r){var i=t;i.nodeType!=e.Node.ELEMENT_NODE&&(i=i.parentNode);while(i&&i.nodeType==e.Node.ELEMENT_NODE&&At(i,r)===null)i=i.parentNode;i&&i.nodeType==e.Node.ELEMENT_NODE?n.push([t,r,At(i,r)]):n.push([t,r,null])})}),n}function _t(t,n){e(t).forEach(function(t){var r=t[0],i=t[1],s=t[2],o=r;if(!o||o.nodeType!=e.Node.ELEMENT_NODE)o=o.parentNode;while(o&&o.nodeType==e.Node.ELEMENT_NODE&&At(o,i)===null)o=o.parentNode;s===null&&o&&o.nodeType==e.Node.ELEMENT_NODE?Pt(r,i,null,n):(o&&o.nodeType==e.Node.ELEMENT_NODE&&!Ct(i,At(o,i),s)||(!o||o.nodeType!=e.Node.ELEMENT_NODE)&&s!==null)&&Ht(r,i,s,n)})}function Dt(e,t,n){if(!V(e))return[];if(At(e,t)===null)return[];if(Nt(e)){var r=Array.prototype.slice.call(u(e.childNodes));for(var i=0;i<r.length;i++)ht(r[i],e.parentNode,x(e),n);return e.parentNode.removeChild(e),r}return t=="strikethrough"&&e.style.textDecoration.indexOf("line-through")!=-1&&(e.style.textDecoration=="line-through"?e.style.textDecoration="":e.style.textDecoration=e.style.textDecoration.replace("line-through",""),e.getAttribute("style")==""&&e.removeAttribute("style")),t=="underline"&&e.style.textDecoration.indexOf("underline")!=-1&&(e.style.textDecoration=="underline"?e.style.textDecoration="":e.style.textDecoration=e.style.textDecoration.replace("underline",""),e.getAttribute("style")==""&&e.removeAttribute("style")),s[t].relevantCssProperty!==null&&(e.style[s[t].relevantCssProperty]="",e.getAttribute("style")==""&&e.removeAttribute("style")),E(e.namespaceURI)&&e.tagName=="FONT"&&(t=="forecolor"&&e.removeAttribute("color"),t=="fontname"&&e.removeAttribute("face"),t=="fontsize"&&e.removeAttribute("size")),q(e,"A")&&(t=="createlink"||t=="unlink")&&e.removeAttribute("href"),At(e,t)===null?[]:[pt(e,"span",n)]}function Pt(t,n,r,i){if(!t.parentNode||t.parentNode.nodeType!=e.Node.ELEMENT_NODE)return;if(kt(n,Lt(t,n),r))return;var s=t.parentNode,o=[];while(V(s)&&s.nodeType==e.Node.ELEMENT_NODE&&!kt(n,Lt(s,n),r))o.push(s),s=s.parentNode;if(!o.length)return;var a=At(o[o.length-1],n);if(a===null&&a!=r)return;if(r!==null&&!kt(n,Lt(o[o.length-1].parentNode,n),r))return;while(o.length){var s=o.pop();At(s,n)!==null&&(a=At(s,n));var f=Array.prototype.slice.call(u(s.childNodes));At(s,n)!==null&&Dt(s,n,i);for(var l=0;l<f.length;l++){var c=f[l];if(c==t)continue;if(c.nodeType==e.Node.ELEMENT_NODE&&At(c,n)!==null&&!Ct(n,a,At(c,n)))continue;if(c==o[o.length-1])continue;Ht(c,n,a,i)}}}function Ht(n,i,o,u){if(!n.parentNode)return;if(o===null)return;wt(n,"span")&&(Ot(n.previousSibling,i,o,u),Ot(n.nextSibling,i,o,u),gt([n],function(e){return Nt(e)&&Ct(i,At(e,i),o)&&kt(i,Lt(e,i),o)},function(){return null},u));if(kt(i,Lt(n,i),o))return;if(!wt(n,"span")){var a=[];for(var f=0;f<n.childNodes.length;f++){if(n.childNodes[f].nodeType==e.Node.ELEMENT_NODE){var l=At(n.childNodes[f],i);if(l!==null&&!Ct(i,o,l))continue}a.push(n.childNodes[f])}for(var f=0;f<a.length;f++)Ht(a[f],i,o,u);return}if(kt(i,Lt(n,i),o))return;var c=null;r||(i=="bold"&&(o=="bold"||o=="700")&&(c=n.ownerDocument.createElement("b")),i=="italic"&&o=="italic"&&(c=n.ownerDocument.createElement("i")),i=="strikethrough"&&o=="line-through"&&(c=n.ownerDocument.createElement("s")),i=="underline"&&o=="underline"&&(c=n.ownerDocument.createElement("u")),i=="forecolor"&&M(o)&&(c=n.ownerDocument.createElement("span"),t(c).css("color",M(o))),i=="fontname"&&(c=n.ownerDocument.createElement("font"),c.face=o));if(i=="createlink"||i=="unlink"){c=n.ownerDocument.createElement("a"),c.setAttribute("href",o);var h=n.parentNode;while(h)q(h,"A")&&(h=pt(h,"span",u)),h=h.parentNode}i=="fontsize"&&e(["xx-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(o)!=-1&&(!r||o=="xxx-large")&&(c=n.ownerDocument.createElement("font"),c.size=b(o)),(i=="subscript"||i=="superscript")&&o=="subscript"&&(c=n.ownerDocument.createElement("sub")),(i=="subscript"||i=="superscript")&&o=="superscript"&&(c=n.ownerDocument.createElement("sup")),c||(c=n.ownerDocument.createElement("span")),n.parentNode.insertBefore(c,n);var p=s[i].relevantCssProperty;p!==null&&!kt(i,Lt(c,i),o)&&(c.style[p]=o),i=="strikethrough"&&o=="line-through"&&Lt(c,"strikethrough")!="line-through"&&(c.style.textDecoration="line-through"),i=="underline"&&o=="underline"&&Lt(c,"underline")!="underline"&&(c.style.textDecoration="underline"),ht(n,c,c.childNodes.length,u);if(n.nodeType==e.Node.ELEMENT_NODE&&!Ct(i,Lt(n,i),o)){ht(n,c.parentNode,x(c),u),c.parentNode.removeChild(c);var a=[];for(var f=0;f<n.childNodes.length;f++){if(n.childNodes[f].nodeType==e.Node.ELEMENT_NODE){var l=At(n.childNodes[f],i);if(l!==null&&!Ct(i,o,l))continue}a.push(n.childNodes[f])}for(var f=0;f<a.length;f++)Ht(a[f],i,o,u)}}function Bt(t,n,r){r=r||st();if(!e(xt(r)).filter(function(t){return t.nodeType==e.Node.TEXT_NODE},!0).some(V)){"inlineCommandActivatedValues"in s[t]&&ut(t,e(s[t].inlineCommandActivatedValues).indexOf(n)!=-1,r),t=="subscript"&&at("superscript",r),t=="superscript"&&at("subscript",r),n===null?ct(t,r):"value"in s[t]&&lt(t,n,r);return}if(V(r.startContainer)&&r.startContainer.nodeType==e.Node.TEXT_NODE&&r.startOffset!=0&&r.startOffset!=T(r.startContainer)){var i=r.startContainer.splitText(r.startOffset),o=Aloha.createRange();if(r.startContainer==r.endContainer){var u=r.endOffset-r.startOffset;o.setEnd(i,u),r.setEnd(i,u)}o.setStart(i,0),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(o),r.setStart(i,0)}if(V(r.endContainer)&&r.endContainer.nodeType==e.Node.TEXT_NODE&&r.endOffset!=0&&r.endOffset!=T(r.endContainer)){var a=r,f=[a.startContainer,a.startOffset],l=[a.endContainer,a.endOffset];a.endContainer.splitText(a.endOffset),a.setStart(f[0],f[1]),a.setEnd(l[0],l[1]),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(a)}e(xt(st(),function(t){return V(t)&&t.nodeType==e.Node.ELEMENT_NODE})).forEach(function(e){Dt(e,t,r)}),e(xt(r,V)).forEach(function(e){Pt(e,t,n,r),Ht(e,t,n,r)})}function jt(t){t=e(t).trim();if(/^[-+]?[0-9]+(\.[0-9]+)?([eE][-+]?[0-9]+)?$/.test(t)){var n;t[0]=="+"?(t=t.slice(1),n="relative-plus"):t[0]=="-"?(t=t.slice(1),n="relative-minus"):n="absolute";var r=parseInt(t);n=="relative-plus"&&(r+=3),n=="relative-minus"&&(r=3-r),r<1&&(r=1),r>7&&(r=7),t={1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[r]}return t}function Ft(t){t=jt(t);if(e(["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(t)==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc|px)$/.test(t))return null;var n=document.createElement("font");document.body.appendChild(n),t=="xxx-large"?n.size=7:n.style.fontSize=t;var r=parseInt(e.getComputedStyle(n).fontSize);document.body.removeChild(n);var i=1;while(i<7){var n=document.createElement("font");n.size=i,document.body.appendChild(n);var s=parseInt(e.getComputedStyle(n).fontSize);n.size=1+i;var o=parseInt(e.getComputedStyle(n).fontSize);document.body.removeChild(n);var u=(o+s)/2;if(r<u)return String(i);i++}return"7"}function It(e){if(!q(e))return!1;if(e.tagName=="BLOCKQUOTE")return!0;if(e.tagName!="DIV")return!1;if(typeof e.style.length!="undefined"){for(var t=0;t<e.style.length;t++)if(/^(-[a-z]+-)?margin/.test(e.style[t]))return!0}else for(var n in e.style)if(/^(-[a-z]+-)?margin/.test(n)&&e.style[n]&&e.style[n]!==0)return!0;return!1}function qt(t){if(!It(t))return!1;if(t.tagName!="BLOCKQUOTE"&&t.tagName!="DIV")return!1;for(var n=0;n<t.attributes.length;n++)if(!E(t.attributes[n].namespaceURI)||e(["style","class","dir"]).indexOf(t.attributes[n].name)==-1)return!1;if(typeof t.style.length!="undefined"){for(var n=0;n<t.style.length;n++)if(!/^(-[a-z]+-)?(margin|border|padding)/.test(t.style[n]))return!1}else for(var r in t.style)if(!/^(-[a-z]+-)?(margin|border|padding)/.test(r)&&t.style[r]&&t.style[r]!==0&&t.style[r]!=="false")return!1;return!0}function Rt(e){return q(e,["address","div","h1","h2","h3","h4","h5","h6","listing","p","pre","xmp"])}function Ut(e){return Rt(e)||q(e,["li","dt","dd"])}function Wt(n,r){if(!V(n))return;if(e(m(n)).every(function(e){return!K(n,e)||!wt(n,e)})&&!q(n,zt)){if(q(n,["dd","dt"])){gt([n],function(e){return q(e,"dl")&&!e.attributes.length},function(){return document.createElement("dl")},r);return}if(!U(n))return;n=pt(n,zt,r),Wt(n,r);var i=g(n);for(var s=0;s<i.length;s++)Wt(i[s],r);return}var o=Mt([n]);while(!wt(n,n.parentNode)){for(var s=n.parentNode.childNodes.length-1;s>=0;--s)n.parentNode.childNodes[s].nodeType==3&&n.parentNode.childNodes[s].data.length==0&&(n.parentNode.removeChild(n.parentNode.childNodes[s]),r.startContainer==n.parentNode&&r.startOffset>s&&r.startOffset--,r.endContainer==n.parentNode&&r.endOffset>s&&r.endOffset--);if(n.parentNode.childNodes.length==1){var u=!1,a=!1;r.startContainer===n.parentNode&&(u=!0),r.endContainer===n.parentNode&&(a=!0),t(n).unwrap(),u&&(r.startContainer=n.parentNode,r.startOffset=r.startOffset+x(n)),a&&(r.endContainer=n.parentNode
,r.endOffset=r.endOffset+x(n))}else on([n],r)}_t(o,r)}function Xt(t,n){if(!q(t,"LI")||!V(t)||!V(t.parentNode))return;var r=null;while(e(t.childNodes).some(function(e){return q(e,["OL","UL"])})){var i=t.lastChild;q(i,["OL","UL"])||!r&&i.nodeType==e.Node.TEXT_NODE&&/^[ \t\n\f\r]*$/.test(i.data)?(r=null,ht(i,t.parentNode,1+x(t),n)):(r||(r=t.ownerDocument.createElement("li"),t.parentNode.insertBefore(r,t.nextSibling)),ht(i,r,0,n))}}function Vt(e,n){if(!q(e,["OL","UL"])||!V(e))return;var r=t(e);r.children("ol,ul").each(function(e,t){q(t.previousSibling,"LI")&&ht(t,t.previousSibling,t.previousSibling.childNodes.length,n)})}function $t(){var t=Yt(st()),n=L(t,function(e){return V(e)&&!It(e)&&(q(e,["ol","ul"])||q(e.parentNode,["ol","ul"])||wt(e,"li"))});if(!n.length)return"none";if(e(n).every(function(e){return q(e,"ol")||q(e.parentNode,"ol")||q(e.parentNode,"li")&&q(e.parentNode.parentNode,"ol")})&&!e(n).some(function(e){return q(e,"ul")||"querySelector"in e&&e.querySelector("ul")}))return"ol";if(e(n).every(function(e){return q(e,"ul")||q(e.parentNode,"ul")||q(e.parentNode,"li")&&q(e.parentNode.parentNode,"ul")})&&!e(n).some(function(e){return q(e,"ol")||"querySelector"in e&&e.querySelector("ol")}))return"ul";var r=e(n).some(function(e){return q(e,"ol")||q(e.parentNode,"ol")||"querySelector"in e&&e.querySelector("ol")||q(e.parentNode,"li")&&q(e.parentNode.parentNode,"ol")}),i=e(n).some(function(e){return q(e,"ul")||q(e.parentNode,"ul")||"querySelector"in e&&e.querySelector("ul")||q(e.parentNode,"li")&&q(e.parentNode.parentNode,"ul")});return r&&i?"mixed":r?"mixed ol":i?"mixed ul":"none"}function Jt(t){while(t&&t.nodeType!=e.Node.ELEMENT_NODE||t.nodeType==e.Node.ELEMENT_NODE&&e(["inline","none"]).indexOf(e.getComputedStyle(t).display)!=-1)t=t.parentNode;if(!t||t.nodeType!=e.Node.ELEMENT_NODE)return"left";var n=e.getComputedStyle(t).textAlign.replace(/^-(moz|webkit)-/,"").replace(/^auto$/,"start");return n=="start"?S(t)=="ltr"?"left":"right":n=="end"?S(t)=="ltr"?"right":"left":e(["center","justify","left","right"]).indexOf(n)!=-1?n:"left"}function Kt(e,t){return!e.parentNode&&t==0||0<=t-1&&t-1<e.childNodes.length&&tt(e.childNodes[t-1])&&(z(e.childNodes[t-1])||q(e.childNodes[t-1],"br"))}function Qt(e,t){return!e.parentNode&&t==T(e)||t<e.childNodes.length&&tt(e.childNodes[t])&&z(e.childNodes[t])}function Gt(e,t){return Kt(e,t)||Qt(e,t)}function Yt(t){var n=t.startContainer,r=t.startOffset,i=t.endContainer,s=t.endOffset,o=e(m(n).concat(n)).filter(function(e){return q(e,"li")}).slice(-1);o.length&&(r=x(o[0]),n=o[0].parentNode);if(!Kt(n,r))do r==0?(r=x(n),n=n.parentNode):r--;while(!Gt(n,r));while(r==0&&n.parentNode)r=x(n),n=n.parentNode;var o=e(m(i).concat(i)).filter(function(e){return q(e,"li")}).slice(-1);o.length&&(s=1+x(o[0]),i=o[0].parentNode);if(!Qt(i,s))do s==T(i)?(s=1+x(i),i=i.parentNode):s++;while(!Gt(i,s));while(s==T(i)&&i.parentNode)s=1+x(i),i=i.parentNode;var u=Aloha.createRange();return u.setStart(n,r),u.setEnd(i,s),u}function Zt(e){var t=0;while(!Gt(e,t)){if(0<=t-1&&t-1<e.childNodes.length&&tt(e.childNodes[t-1]))return!1;t==0||!e.hasChildNodes()?(t=x(e),e=e.parentNode):(e=e.childNodes[t-1],t=T(e))}return!0}function en(e){var t=T(e);while(!Gt(e,t)){if(t<e.childNodes.length&&tt(e.childNodes[t]))return!1;t==T(e)||!e.hasChildNodes()?(t=1+x(e),e=e.parentNode):(e=e.childNodes[t],t=0)}return!0}function tn(t){var n=[];return ft("createlink",t)!==undefined&&n.push(["createlink",ft("createlink",t)]),e(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(e){ot(e,t)!==undefined&&n.push([e,ot(e,t)])}),e(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(e){ft(e,t)!==undefined&&n.push([e,ft(e,t)])}),n}function nn(t){var n=[],r=e(xt(t)).filter(function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0];return r?(n.push(["createlink",s.createlink.value(t)]),e(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(t){e(s[t].inlineCommandActivatedValues).indexOf(Lt(r,t))!=-1?n.push([t,!0]):n.push([t,!1])}),e(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(e){n.push([e,s[e].value(t)])}),n.push("fontsize",Lt(r,"fontsize")),n):n}function rn(t,n){var r=e(xt(n)).filter(function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0];if(r)for(var i=0;i<t.length;i++){var s=t[i][0],o=t[i][1];if(typeof o=="boolean"&&j(s)!=o)P(s);else if(typeof o=="string"&&s!="fontsize"&&!Ct(s,I(s),o))P(s,!1,o);else{if(typeof o!="string"||s!="fontsize"||!(ft("fontsize",n)!==undefined&&ft("fontsize",n)!==o||ft("fontsize",n)===undefined&&!kt(s,Lt(r,"fontsize"),o)))continue;P("fontsize",!1,o)}r=e(xt(n)).filter(function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0]||r}else for(var i=0;i<t.length;i++){var s=t[i][0],o=t[i][1];typeof o=="boolean"&&ut(s,o,n),typeof o=="string"&&lt(s,o,n)}}function sn(){var t,n={};arguments.length<3?t=arguments[0]:(t=Aloha.createRange(),t.setStart(arguments[0],arguments[1]),t.setEnd(arguments[2],arguments[3])),arguments.length==2&&(n=arguments[1]),arguments.length==5&&(n=arguments[4]);var r="blockMerging"in n?!!n.blockMerging:!0,i="stripWrappers"in n?!!n.stripWrappers:!0;if(!t)return;var s=t.startContainer,o=t.startOffset,a=t.endContainer,f=t.endOffset;while(s.hasChildNodes()){if(o==T(s)&&K(s,s.parentNode)&&W(s)){o=1+x(s),s=s.parentNode;continue}if(o==T(s))break;var l=s.childNodes[o];if(z(l)||l.nodeType==e.Node.ELEMENT_NODE&&!l.hasChildNodes()||l.nodeType!=e.Node.ELEMENT_NODE&&l.nodeType!=e.Node.TEXT_NODE)break;s=l,o=0}while(a.hasChildNodes()){if(f==0&&K(a,a.parentNode)&&W(a)){f=x(a),a=a.parentNode;continue}if(f==0)break;var l=a.childNodes[f-1];if(z(l)||l.nodeType==e.Node.ELEMENT_NODE&&!l.hasChildNodes()||l.nodeType!=e.Node.ELEMENT_NODE&&l.nodeType!=e.Node.TEXT_NODE)break;a=l,f=T(l)}if(N(a,f,s,o)!=="after"){t.setEnd(t.startContainer,t.startOffset);return}s.nodeType==e.Node.TEXT_NODE&&o==0&&s!=a,a.nodeType==e.Node.TEXT_NODE&&f==T(a)&&s!=a&&(f=1+x(a),a=a.parentNode),t.setStart(s,o),t.setEnd(a,f);var h=t.startContainer;while(K(h,h.parentNode)&&W(h))h=h.parentNode;if(!z(h)&&!X(h)||!wt("span",h)||q(h,["td","th"]))h=null;var d=t.endContainer;while(K(d,d.parentNode)&&W(d))d=d.parentNode;if(!z(d)&&!X(d)||!wt("span",d)||q(d,["td","th"]))d=null;var v=nn(t);if(s==a&&V(s)&&s.nodeType==e.Node.TEXT_NODE){var m=s.parentNode;s.deleteData(o,f-o),fn(s,o),t.setEnd(t.startContainer,t.startOffset),rn(v,t),(V(m)||X(m))&&!W(m)&&m.offsetHeight===0&&m.appendChild(dn());return}V(s)&&s.nodeType==e.Node.TEXT_NODE&&s.deleteData(o,T(s)-o);var g=L(t,function(e){return V(e)&&!q(e,["thead","tbody","tfoot","tr","th","td"])});for(var y=0;y<g.length;y++){var b=g[y],m=b.parentNode;m.removeChild(b);if(i||!c(m,s)&&m!=s)while(V(m)&&W(m)&&T(m)==0){var w=m.parentNode;w.removeChild(m),m=w}(V(m)||X(m))&&!W(m)&&!m.hasChildNodes()&&m.offsetHeight===0&&m.appendChild(dn())}V(a)&&a.nodeType==e.Node.TEXT_NODE&&a.deleteData(0,f),fn(t.startContainer,t.startOffset),fn(t.endContainer,t.endOffset);if(!r||!h||!d||!K(h,d)||h==d){t.setEnd(t.startContainer,t.startOffset),rn(v,t);return}h.children.length==1&&rt(h.firstChild)&&h.removeChild(h.firstChild),d.children.length==1&&rt(d.firstChild)&&d.removeChild(d.firstChild);if(c(h,d)){var l=d;while(l.parentNode!=h)l=l.parentNode;t.setStart(h,x(l)),t.setEnd(h,x(l));if(!d.hasChildNodes()){while(V(d)&&d.parentNode.childNodes.length==1&&d.parentNode!=h){var m=d;m.removeChild(d),d=m}V(d)&&!W(d)&&W(d.previousSibling)&&W(d.nextSibling)&&d.parentNode.insertBefore(document.createElement("br"),d.nextSibling),V(d)&&d.parentNode.removeChild(d),rn(v,t);return}if(!W(d.firstChild)){rn(v,t);return}var E=[];E.push(d.firstChild);while(!q(E[E.length-1],"br")&&W(E[E.length-1].nextSibling))E.push(E[E.length-1].nextSibling);var S=Mt(E);while(E[0].parentNode!=h)on(E,t);V(E[0].previousSibling)&&q(E[0].previousSibling,"br")&&E[0].parentNode.removeChild(E[0].previousSibling)}else if(p(h,d)){t.setStart(h,T(h)),t.setEnd(h,T(h));var l=h;while(l.parentNode!=d)l=l.parentNode;W(l.nextSibling)&&q(h.lastChild,"br")&&h.removeChild(h.lastChild);var C=[];l.nextSibling&&!q(l.nextSibling,"br")&&!z(l.nextSibling)&&C.push(l.nextSibling),C.length&&C[C.length-1].nextSibling&&!q(C[C.length-1].nextSibling,"br")&&!z(C[C.length-1].nextSibling)&&C.push(C[C.length-1].nextSibling);var S=Mt(C);e(C).forEach(function(e){ht(e,h,-1,t)}),q(l.nextSibling,"br")&&l.parentNode.removeChild(l.nextSibling)}else{t.setStart(h,T(h)),t.setEnd(h,T(h)),W(d.firstChild)&&q(h.lastChild,"br")&&h.removeChild(h.lastChild);var S=Mt([].slice.call(u(d.childNodes)));while(d.hasChildNodes())ht(d.firstChild,h,-1,t);while(!d.hasChildNodes()){var m=d.parentNode;m.removeChild(d),d=m}}_t(S,t),!h.hasChildNodes()&&h.offsetHeight==0&&h.appendChild(dn()),rn(v,t)}function on(t,n){var r=t[0].parentNode;if(!V(r)||!r.parentNode)return;e(t).indexOf(r.firstChild)!=-1&&dt(r);var i=e(t).indexOf(r.firstChild)!=-1&&Zt(r),s=e(t).indexOf(r.lastChild)!=-1&&en(r);if(e(t).indexOf(r.firstChild)==-1&&e(t).indexOf(r.lastChild)!=-1){for(var o=t.length-1;o>=0;o--)ht(t[o],r.parentNode,1+x(r),n);s&&!en(t[t.length-1])&&t[t.length-1].parentNode.insertBefore(document.createElement("br"),t[t.length-1].nextSibling),vt(r);return}if(e(t).indexOf(r.firstChild)==-1){var u=r.cloneNode(!1);r.removeAttribute("id"),r.parentNode.insertBefore(u,r);while(t[0].previousSibling)ht(r.firstChild,u,u.childNodes.length,n)}for(var o=0;o<t.length;o++)ht(t[o],r.parentNode,x(r),n);i&&!Zt(t[0])&&t[0].parentNode.insertBefore(document.createElement("br"),t[0]),W(t[t.length-1])&&!q(t[t.length-1],"br")&&q(r.firstChild,"br")&&!W(r)&&r.removeChild(r.firstChild),r.hasChildNodes()?dt(r):(r.parentNode===n.startContainer&&r.parentNode===n.endContainer&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset&&r.parentNode.childNodes.length===n.startOffset&&(n.startOffset=r.parentNode.childNodes.length-1,n.endOffset=n.startOffset),r.parentNode.removeChild(r),s&&!en(t[t.length-1])&&t[t.length-1].parentNode.insertBefore(document.createElement("br"),t[t.length-1].nextSibling)),!t[t.length-1].nextSibling&&t[t.length-1].parentNode&&vt(t[t.length-1].parentNode)}function un(e,t){e.hasChildNodes()?on([].slice.call(u(e.childNodes)),t):e.parentNode.removeChild(e)}function an(e,t,n){if(e==0)return"";if(e==1&&!t&&!n)return" ";if(e==1)return" ";var r="",i;t?i="  ":i="  ";while(e>3)r+=i,e-=2;return e==3?r+=!t&&!n?"   ":t&&!n?"   ":!t&&n?"   ":t&&n?"   ":"impossible":r+=!t&&!n?"  ":t&&!n?"  ":!t&&n?"  ":t&&n?"  ":"impossible",r}function fn(t,n){if(!V(t)&&!X(t))return;var r=t,i=n;for(;;)if(0<=i-1&&K(r,r.childNodes[i-1]))r=r.childNodes[i-1],i=T(r);else if(i==0&&!Zt(r)&&K(r,r.parentNode))i=x(r),r=r.parentNode;else{if(r.nodeType!=e.Node.TEXT_NODE||e(["pre","pre-wrap"]).indexOf(e.getComputedStyle(r.parentNode).whiteSpace)!=-1||i==0||!/[ \xa0]/.test(r.data[i-1]))break;i--}var s=r,o=i,u=0,a=!1;for(;;)if(o<s.childNodes.length&&K(s,s.childNodes[o]))s=s.childNodes[o],o=0;else if(o==T(s)&&!en(s)&&K(s,s.parentNode))o=1+x(s),s=s.parentNode;else{if(s.nodeType!=e.Node.TEXT_NODE||e(["pre","pre-wrap"]).indexOf(e.getComputedStyle(s.parentNode).whiteSpace)!=-1||o==T(s)||!/[ \xa0]/.test(s.data[o]))break;if(a&&" "==s.data[o]){s.deleteData(o,1);continue}a=" "==s.data[o],o++,u++}var f=an(u,i==0&&Zt(r),o==T(s)&&en(s));while(N(r,i,s,o)=="before")if(i<r.childNodes.length)r=r.childNodes[i],i=0;else if(r.nodeType!=e.Node.TEXT_NODE||i==T(r))i=1+x(r),r=r.parentNode;else{var l=f[0];f=f.slice(1),l!=r.data[i]&&(r.insertData(i,l),r.deleteData(i+1,1)),i++}}function ln(e,t){if(!e.length)return;var n=e[0];if(q(n.parentNode,["OL","UL"])){var r=n.parentNode.tagName;gt(e,function(e){return q(e,r)},function(){return n.ownerDocument.createElement(r)},t);return}var i=gt(e,function(e){return qt(e)},function(){return n.ownerDocument.createElement("blockquote")},t);Wt(i,t)}function cn(t,n){if(!V(t))return;if(qt(t)){un(t,n);return}if(It(t)){t.removeAttribute("class"),t.removeAttribute("dir"),t.style.margin="",t.style.padding="",t.style.border="",t.getAttribute("style")==""&&t.removeAttribute("style"),pt(t,"div",n);return}var r=t.parentNode,i=[];while(V(r)&&r.nodeType==e.Node.ELEMENT_NODE&&!qt(r)&&!q(r,["ol","ul"]))i.push(r),r=r.parentNode;if(!V(r)||!qt(r)){r=t.parentNode,i=[];while(V(r)&&r.nodeType==e.Node.ELEMENT_NODE&&!It(r)&&!q(r,["ol","ul"]))i.push(r),r=r.parentNode}if(q(t,["OL","UL"])&&(!V(r)||!It(r))){t.removeAttribute("reversed"),t.removeAttribute("start"),t.removeAttribute("type");var s=[].slice.call(u(t.childNodes));if(t.attributes.length&&!q(t.parentNode,["OL","UL"]))pt(t,"div",n);else{var o=Mt([].slice.call(u(t.childNodes)));un(t,n),_t(o,n)}for(var a=0;a<s.length;a++)Wt(s[a],n);return}if(!V(r)||!It(r))return;i.push(r);var f=r;while(i.length){r=i.pop();var l=t.parentNode==r?t:i[i.length-1];W(l)&&!q(l,"BR")&&q(l.nextSibling,"BR")&&l.parentNode.removeChild(l.nextSibling);var c=[].slice.call(u(r.childNodes),0,x(l)),h=[].slice.call(u(r.childNodes),1+x(l));ln(c,n),ln(h,n)}cn(f,n)}function hn(t,n){var r=$t()==t?"disable":"enable";t=t.toUpperCase();var i=t=="OL"?"UL":"OL",s=[];(function(){for(var e=n.endContainer;e!=n.commonAncestorContainer;e=e.parentNode)q(e,"li")&&s.unshift(e);for(var e=n.startContainer;e;e=e.parentNode)q(e,"li")&&s.unshift(e)})(),e(s).forEach(function(e){Xt(e,n)});var o=Yt(n);r=="enable"&&e(A(o,function(e){return V(e)&&q(e,i)})).forEach(function(e){if(V(e.previousSibling)&&q(e.previousSibling,t)||V(e.nextSibling)&&q(e.nextSibling,t)){var r=[].slice.call(u(e.childNodes)),i=Mt(r);on(r,n),gt(r,function(e){return q(e,t)},function(){return null},n),_t(i,n)}else pt(e,t,n)});var a=L(o,function(e){return V(e)&&!It(e)&&(q(e,["OL","UL"])||q(e.parentNode,["OL","UL"])||wt(e,"li"))});r=="enable"&&(a=e(a).filter(function(e){return!q(e,["ol","ul"])||q(e.parentNode,["ol","ul"])}));if(r=="disable")while(a.length){var f=[];f.push(a.shift());if(q(f[0],t)){cn(f[0],n);continue}while(a.length&&a[0]==f[f.length-1].nextSibling&&!q(a[0],t))f.push(a.shift());var l=Mt(f);on(f,n);for(var c=0;c<f.length;c++)Wt(f[c],n);_t(l,n)}else while(a.length){var f=[];while(!f.length||a.length&&a[0]==f[f.length-1].nextSibling)if(q(a[0],["p","div"]))f.push(pt(a[0],"li",n)),a.shift();else if(q(a[0],["li","ol","ul"]))f.push(a.shift());else{var h=[];while(!h.length||a.length&&a[0]==h[h.length-1].nextSibling&&W(a[0])&&W(h[h.length-1])&&!q(h[h.length-1],"br"))h.push(a.shift());f.push(gt(h,undefined,function(){return document.createElement("li")},n))}if(q(f[0].parentNode,t)||e(f).every(function(e){return q(e,["ol","ul"])}))continue;if(q(f[0].parentNode,i)){var l=Mt(f);on(f,n),gt(f,function(e){return q(e,t)},function(){return document.createElement(t)},n),_t(l,n);continue}Wt(gt(f,function(e){return q(e,t)},function(){if(!V(f[0].parentNode)||!qt(f[0].parentNode)||!V(f[0].parentNode.previousSibling)||!q(f[0].parentNode.previousSibling,t))return document.createElement(t);var e=f[0].parentNode.previousSibling;return Xt(e.lastChild,n),(!V(e.lastChild)||!q(e.lastChild,t))&&e.appendChild(document.createElement(t)),e.lastChild},n),n)}}function pn(t,n){var r=Yt(n),s=A(r,function(t){return t.nodeType==e.Node.ELEMENT_NODE&&V(t)&&(e(t).hasAttribute("align")||t.style.textAlign!=""||q(t,"center"))});for(var u=0;u<s.length;u++){var a=s[u];a.removeAttribute("align"),a.style.textAlign="",a.getAttribute("style")==""&&a.removeAttribute("style"),q(a,["div","span","center"])&&!a.attributes.length&&un(a,n),q(a,"center")&&a.attributes.length&&pt(a,"div",n)}r=Yt(i);var f=[];f=L(r,function(e){return V(e)&&wt(e,"div")&&Jt(e)!=t});while(f.length){var l=[];l.push(f.shift());while(f.length&&f[0]==l[l.length-1].nextSibling)l.push(f.shift());gt(l,function(n){return q(n,"div")&&e(n.attributes).every(function(e){return e.name=="align"&&e.value.toLowerCase()==t||e.name=="style"&&o(n)==1&&n.style.textAlign==t})},function(){var e=document.createElement("div");return e.setAttribute("style","text-align: "+t),e},n)}}function dn(){var e=document.createElement("br");return e.setAttribute("class","aloha-end-br"),e}var n="http://www.w3.org/1999/xhtml",r=!1,i=null,s={},_=0,R=["address","article","aside","blockquote","caption","center","col","colgroup","dd","details","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","listing","menu","nav","ol","p","plaintext","pre","section","summary","table","tbody","td","tfoot","th","thead","tr","ul","xmp"],ot,ut,at,ft,lt,ct;(function(){function r(r){if(!n||n.startContainer!=r.startContainer||n.endContainer!=r.endContainer||n.startOffset!=r.startOffset||n.endOffset!=r.endOffset)e={},t={},n=r.cloneRange()}var e={},t={},n=null;ot=function(t,n){return r(n),e[t]},ut=function(t,n,i){r(i),e[t]=n},at=function(t,n){r(n),delete e[t]},ft=function(e,n){return r(n),t[e]},lt=function(e,n,i){r(i),t[e]=n,e=="backcolor"?t.hilitecolor=n:e=="hilitecolor"&&(t.backcolor=n)},ct=function(e,n){r(n),delete t[e],e=="backcolor"?delete t.hilitecolor:e=="hilitecolor"&&delete t.backcolor}})();var yt=["a","abbr","b","bdi","bdo","cite","code","dfn","em","h1","h2","h3","h4","h5","h6","i","kbd","mark","p","pre","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","u","var","acronym","listing","strike","xmp","big","blink","font","marquee","nobr","tt"];s.backcolor={action:function(e){/^([0-9a-fA-F]{3}){1,2}$/.test(e)&&(e="#"+e);if(!/^(rgba?|hsla?)\(.*\)$/.test(e)&&!M(e)&&e.toLowerCase()!="transparent")return;Bt("backcolor",e)},standardInlineValueCommand:!0,relevantCssProperty:"backgroundColor",equivalentValues:function(e,t){return O(e)===O(t)}},s.bold={action:function(e,t){j("bold",t)?Bt("bold","normal",t):Bt("bold","bold",t)},inlineCommandActivatedValues:["bold","600","700","800","900"],relevantCssProperty:"fontWeight",equivalentValues:function(e,t){return e==t||e=="bold"&&t=="700"||e=="700"&&t=="bold"||e=="normal"&&t=="400"||e=="400"&&t=="normal"}},s.createlink={action:function(t){if(t==="")return;e(xt(st())).forEach(function(n){e(m(n)).forEach(function(n){V(n)&&q(n,"a")&&e(n).hasAttribute("href")&&n.setAttribute("href",t)})}),Bt("createlink",t)},standardInlineValueCommand:!0},s.fontname={action:function(e){Bt("fontname",e)},standardInlineValueCommand:!0,relevantCssProperty:"fontFamily"},s.fontsize={action:function(t){if(t==="")return;t=jt(t);if(e(["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(t)==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc)$/.test(t))return;Bt("fontsize",t)},indeterm:function(){return e(xt(st(),function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})).map(function(e){return Lt(e,"fontsize")},!0).filter(function(t,n,r){return e(r.slice(0,n)).indexOf(t)==-1}).length>=2},value:function(t){var n=xt(t,function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0];n===undefined&&(n=t.startContainer);var r=Lt(n,"fontsize");return Ft(r)},relevantCssProperty:"fontSize"},s.forecolor={action:function(e){/^([0-9a-fA-F]{3}){1,2}$/.test(e)&&(e="#"+e);if(!/^(rgba?|hsla?)\(.*\)$/.test(e)&&!M(e)&&e.toLowerCase()!="transparent")return;Bt("forecolor",e)},standardInlineValueCommand:!0,relevantCssProperty:"color",equivalentValues:function(e,t){return O(e)===O(t)}},s.hilitecolor={action:function(e){/^([0-9a-fA-F]{3}){1,2}$/.test(e)&&(e="#"+e);if(!/^(rgba?|hsla?)\(.*\)$/.test(e)&&!M(e)&&e.toLowerCase()!="transparent")return;Bt("hilitecolor",e)},indeterm:function(){return e(xt(st(),function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})).map(function(e){return Lt(e,"hilitecolor")},!0).filter(function(t,n,r){return e(r.slice(0,n)).indexOf(t)==-1}).length>=2},standardInlineValueCommand:!0,relevantCssProperty:"backgroundColor",equivalentValues:function(e,t){return O(e)===O(t)}},s.italic={action:function(e,t){j("italic",t)?Bt("italic","normal",t):Bt("italic","italic",t)},inlineCommandActivatedValues:["italic","oblique"],relevantCssProperty:"fontStyle"},s.removeformat={action:function(){function t(e){return V(e)&&q(e,["abbr","acronym","b","bdi","bdo","big","blink","cite","code","dfn","em","font","i","ins","kbd","mark","nobr","q","s","samp","small","span","strike","strong","sub","sup","tt","u","var"])}var n=xt(st(),t);e(n).forEach(function(e){while(e.hasChildNodes())ht(e.firstChild,e.parentNode,x(e),range);e.parentNode.removeChild(e)});if(V(st().startContainer)&&st().startContainer.nodeType==e.Node.TEXT_NODE&&st().startOffset!=0&&st().startOffset!=T(st().startContainer))if(st().startContainer==st().endContainer){var r=st().endOffset-st().startOffset,i=st().startContainer.splitText(st().startOffset);st().setStart(i,0),st().setEnd(i,r)}else st().setStart(st().startContainer.splitText(st().startOffset),0);if(V(st().endContainer)&&st().endContainer.nodeType==e.Node.TEXT_NODE&&st().endOffset!=0&&st().endOffset!=T(st().endContainer)){var s=[st().startContainer,st().startOffset],r=[st().endContainer,st().endOffset];st().setEnd(document.documentElement,0),r[0].splitText(r[1]),st().setStart(s[0],s[1]),st().setEnd(r[0],r[1])}e(xt(st(),V)).forEach(function(e){while(t(e.parentNode)&&K(e.parentNode,e))on([e],range)}),e(["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"]).forEach(function(e){Bt(e,null)})}},s.strikethrough={action:function(){j("strikethrough")?Bt("strikethrough",null):Bt("strikethrough","line-through")},inlineCommandActivatedValues:["line-through"]},s.subscript={action:function(){var e=j("subscript");Bt("subscript",null),e||Bt("subscript","subscript")},indeterm:function(){var t=xt(st(),function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE});return e(t).some(function(e){return Lt(e,"subscript")=="subscript"})&&e(t).some(function(e){return Lt(e,"subscript")!="subscript"})||e(t).some(function(e){return Lt(e,"subscript")=="mixed"})},inlineCommandActivatedValues:["subscript"]},s.superscript={action:function(){var e=j("superscript");Bt("superscript",null),e||Bt("superscript","superscript")},indeterm:function(){var t=xt(st(),function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE});return e(t).some(function(e){return Lt(e,"superscript")=="superscript"})&&e(t).some(function(e){return Lt(e,"superscript")!="superscript"})||e(t).some(function(e){return Lt(e,"superscript")=="mixed"})},inlineCommandActivatedValues:["superscript"]},s.underline={action:function(){j("underline")?Bt("underline",null):Bt("underline","underline")},inlineCommandActivatedValues:["underline"]},s.unlink={action:function(){var t=st(),n=[];for(var r=t.startContainer;r;r=r.parentNode)q(r,"A")&&e(r).hasAttribute("href")&&n.unshift(r);for(var r=t.startContainer;r!=l(t.endContainer);r=a(r))q(r,"A")&&e(r).hasAttribute("href")&&(k(r,t)||c(r,t.endContainer)||r==t.endContainer)&&n.push(r);for(var i=0;i<n.length;i++)Dt(n[i],"unlink",t)},standardInlineValueCommand:!0};var zt="p";s["delete"]={action:function(t,n){if(!n.collapsed){sn(n);return}fn(n.startContainer,n.startOffset);var r=n.startContainer,i=n.startOffset,s=!1,o=!1;for(;;){i>0&&(s=q(r.childNodes[i-1],"br")||!1,o=q(r.childNodes[i-1],"hr")||!1);if(i==0&&V(r.previousSibling)&&nt(r.previousSibling))r.parentNode.removeChild(r.previousSibling);else if(0<=i-1&&i-1<r.childNodes.length&&V(r.childNodes[i-1])&&(nt(r.childNodes[i-1])||s||o)){r.removeChild(r.childNodes[i-1]),i--;if(s||o){n.setStart(r,i),n.setEnd(r,i);return}}else if(i==0&&W(r)||nt(r))i=x(r),r=r.parentNode;else{if(0<=i-1&&i-1<r.childNodes.length&&V(r.childNodes[i-1])&&q(r.childNodes[i-1],"a")){un(r.childNodes[i-1],n);return}if(!(0<=i-1&&i-1<r.childNodes.length&&!z(r.childNodes[i-1])&&!q(r.childNodes[i-1],["br","img"])))break;r=r.childNodes[i-1],i=T(r)}}Z(r,n),i=n.startOffset;if(r.nodeType==e.Node.TEXT_NODE&&i!=0){n.setStart(r,i),n.setEnd(r,i),n.startOffset-=1,sn(n);return}if(W(r))return;if(0<=i-1&&i-1<r.childNodes.length&&q(r.childNodes[i-1],["br","hr","img"])){n.setStart(r,i),n.setEnd(r,i),sn(n);return}if(q(r,["li","dt","dd"])&&r==r.parentNode.firstChild&&i==0){var u=[];for(var a=r.parentNode;a;a=a.parentNode)q(a,"li")&&u.unshift(a);for(var f=0;f<u.length;f++)Xt(u[f],n);var l=Mt([r]);on([r],n),_t(l,n),q(r,["dd","dt"])&&e(m(r)).every(function(e){return!K(r,e)||!wt(r,e)})&&(r=pt(r,zt,n)),Wt(r,n);for(var f=0;f<u.length;f++)Vt(u[f].parentNode,n);return}var c=r,p=i;for(;;)if(p==0)p=x(c),c=c.parentNode;else{if(!(0<=p-1&&p-1<c.childNodes.length&&V(c.childNodes[p-1])&&nt(c.childNodes[p-1])))break;c.removeChild(c.childNodes[p-1]),p--}if(i==0&&e(m(r).concat(r)).filter(function(e){return V(e)&&K(e,r)&&It(e)}).length){var d=Aloha.createRange();d.setStart(r,0),d.setEnd(r,0),d=Yt(d);var v=L(d,function(e){return V(e)&&!$(e)});for(var f=0;f<v.length;f++)cn(v[f],n);return}if(q(c.childNodes[p],"table"))return;if(0<=p-1&&p-1<c.childNodes.length&&q(c.childNodes[p-1],"table")){n.setStart(c,p-1),n.setEnd(c,p);return}if(i==0&&(q(c.childNodes[p-1],"hr")||q(c.childNodes[p-1],"br")&&(q(c.childNodes[p-1].previousSibling,"br")||!W(c.childNodes[p-1].previousSibling)))){n.setStart(r,i),n.setEnd(r,i),sn(c,p-1,c,p);return}if(q(c.childNodes[p],["li","dt","dd"])&&W(c.childNodes[p].firstChild)&&p!=0){var g=c.childNodes[p-1];W(g.lastChild)&&!q(g.lastChild,"br")&&g.appendChild(document.createElement("br")),W(g.lastChild)&&g.appendChild(document.createElement("br"))}if(q(c.childNodes[p],["li","dt","dd"])&&q(c.childNodes[p-1],["li","dt","dd"]))c=c.childNodes[p-1],p=T(c),r=c.nextSibling,i=0;else while(0<=p-1&&p-1<c.childNodes.length)V(c.childNodes[p-1])&&nt(c.childNodes[p-1])?(c.removeChild(c.childNodes[p-1]),p--):(c=c.childNodes[p-1],p=T(c));var y=Aloha.createRange();y.setStart(c,p),y.setEnd(r,i),sn(y),h(document.body,n.startContainer)||(y.startContainer.hasChildNodes()||y.startContainer.nodeType==e.Node.TEXT_NODE?(n.setStart(y.startContainer,y.startOffset),n.setEnd(y.startContainer,y.startOffset)):(n.setStart(y.startContainer.parentNode,x(y.startContainer)),n.setEnd(y.startContainer.parentNode,x(y.startContainer))))}};var vn=["address","dd","div","dt","h1","h2","h3","h4","h5","h6","p","pre"];return s.formatblock={action:function(t){/^<.*>$/.test(t)&&(t=t.slice(1,-1)),t=t.toLowerCase();if(e(vn).indexOf(t)==-1)return;var n=Yt(st()),r=L(n,function(t){return V(t)&&(Rt(t)||wt(t,"p")||q(t,["dd","dt"]))&&!e(g(t)).some(U)}),i=Mt(r);for(var s=0;s<r.length;s++){var o=r[s];while(e(m(o)).some(function(t){return V(t)&&K(t,o)&&q(t,vn)&&!e(g(t)).some(U)}))on([o],range)}_t(i,range);while(r.length){var a;if(Ut(r[0])){a=[].slice.call(u(r[0].childNodes));var i=Mt(a);un(r[0],range),_t(i,range),r.shift()}else{a=[],a.push(r.shift());while(r.length&&r[0]==a[a.length-1].nextSibling&&!Ut(r[0])&&!q(a[a.length-1],"BR"))a.push(r.shift())}Wt(gt(a,e(["div","p"]).indexOf(t)==-1?function(e){return q(e,t)&&!e.attributes.length}:function(){return!1},function(){return document.createElement(t)},range),range)}},indeterm:function(){var t=Yt(st()),n=A(t,function(e){return tt(e)&&V(e)&&!e.hasChildNodes()});if(!n.length)return!1;var r=null;for(var i=0;i<n.length;i++){var s=n[i];while(V(s.parentNode)&&K(s,s.parentNode)&&!q(s,vn))s=s.parentNode;var o="";V(s)&&q(s,vn)&&!e(g(s)).some(U)&&(o=s.tagName);if(r===null)r=o;else if(r!=o)return!0}return!1},value:function(){var t=Yt(st()),n=A(t,function(e){return tt(e)&&V(e)&&!e.hasChildNodes()});if(!n.length)return"";var r=n[0];while(V(r.parentNode)&&K(r,r.parentNode)&&!q(r,vn))r=r.parentNode;return V(r)&&q(r,vn)&&!e(g(r)).some(U)?r.tagName.toLowerCase():""}},s.forwarddelete={action:function(t,n){if(!n.collapsed){sn(n);return}fn(n.startContainer,n.startOffset);var r=n.startContainer,i=n.startOffset,s=!1,o=!1;for(;;){i<r.childNodes.length&&(s=q(r.childNodes[i],"br")||!1,o=q(r.childNodes[i],"hr")||!1);if(i==T(r)&&V(r.nextSibling)&&nt(r.nextSibling))r.parentNode.removeChild(r.nextSibling);else if(i<r.childNodes.length&&V(r.childNodes[i])&&(nt(r.childNodes[i])||s||o)){r.removeChild(r.childNodes[i]);if(s||o){n.setStart(r,i),n.setEnd(r,i);return}}else if(i<r.childNodes.length&&rt(r.childNodes[i]))i++;else if(i==T(r)&&W(r)||nt(r))i=1+x(r),r=r.parentNode;else{if(!(i<r.childNodes.length&&!z(r.childNodes[i])&&!q(r.childNodes[i],["br","img"])))break;r=r.childNodes[i],i=0}}Z(r,n),i=n.startOffset;if(r.nodeType==e.Node.TEXT_NODE&&i!=T(r)){n.setStart(r,i),n.setEnd(r,i);var u=i+1;while(u!=r.length&&/^[\u0300-\u036f\u0591-\u05bd\u05c1\u05c2]$/.test(r.data[u]))u++;sn(r,i,r,u);return}if(W(r))return;if(i<r.childNodes.length&&q(r.childNodes[i],["br","hr","img"])){n.setStart(r,i),n.setEnd(r,i),sn(r,i,r,i+1);return}var a=r,u=i;for(;;)if(u==T(a))u=1+x(a),a=a.parentNode;else{if(!(u<a.childNodes.length&&V(a.childNodes[u])&&nt(a.childNodes[u])))break;a.removeChild(a.childNodes[u])}if(q(a.childNodes[u-1],"table"))return;if(q(a.childNodes[u],"table")){n.setStart(a,u),n.setEnd(a,u+1);return}if(i==T(r)&&q(a.childNodes[u],["br","hr"])){n.setStart(r,i),n.setEnd(r,i),sn(a,u,a,u+1);return}while(u<a.childNodes.length)V(a.childNodes[u])&&nt(a.childNodes[u])?a.removeChild(a.childNodes[u]):(a=a.childNodes[u],u=0);sn(r,i,a,u)}},s.indent={action:function(){var e=[];for(var t=st().endContainer;t!=st().commonAncestorContainer;t=t.parentNode)q(t,"LI")&&e.unshift(t);for(var t=st().startContainer;t!=st().commonAncestorContainer;t=t.parentNode)q(t,"LI")&&e.unshift(t);for(var t=st().commonAncestorContainer;t;t=t.parentNode)q(t,"LI")&&e.unshift(t);for(var n=0;n<e.length;n++)Xt(e[n,range]);var r=Yt(st()),i=[];i=L(r,function(e){return V(e)&&(wt(e,"div")||wt(e,"ol"))}),i.length&&q(i[0],"LI")&&q(i[0].parentNode,["OL","UL"])&&q(i[0].previousSibling,"LI")&&Xt(i[0].previousSibling,range);while(i.length){var s=[];s.push(i.shift());while(i.length&&i[0]==s[s.length-1].nextSibling)s.push(i.shift());ln(s,range)}}},s.inserthorizontalrule={action:function(t,n){while(n.startOffset==0&&n.startContainer.parentNode)n.setStart(n.startContainer.parentNode,x(n.startContainer));while(n.endOffset==T(n.endContainer)&&n.endContainer.parentNode)n.setEnd(n.endContainer.parentNode,1+x(n.endContainer));sn(n,{blockMerging:!1});if(!V(st().startContainer)&&!X(st().startContainer))return;st().startContainer.nodeType==e.Node.TEXT_NODE&&st().startOffset==0&&(st().setStart(st().startContainer.parentNode,x(st().startContainer)),st().collapse(!0)),st().startContainer.nodeType==e.Node.TEXT_NODE&&st().startOffset==T(st().startContainer)&&(st().setStart(st().startContainer.parentNode,1+x(st().startContainer)),st().collapse(!0));var r=document.createElement("hr");n.insertNode(r),Wt(r,n),n.setStart(r.parentNode,1+x(r)),n.setEnd(r.parentNode,1+x(r)),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(n)}},s.inserthtml={action:function(t,n){sn(n);if(!V(n.startContainer)&&!X(n.startContainer))return;var r=n.createContextualFragment(t),i=r.lastChild;if(!i)return;var s=g(r);z(n.startContainer)&&e(n.startContainer.childNodes).filter(function(e,t){return V(e)&&rt(e)&&x(e)>=t.startOffset},!0).forEach(function(e){e.parentNode.removeChild(e)}),n.insertNode(r),z(n.startContainer)&&!e(n.startContainer.childNodes).some(tt)&&n.startContainer.appendChild(dn()),n.setStart(i.parentNode,1+x(i)),n.setEnd(i.parentNode,1+x(i));for(var o=0;o<s.length;o++)Wt(s[o],n);it(n)}},s.insertimage={action:function(e){if(e==="")return;var t=st();sn(t,{stripWrappers:!1});if(!V(st().startContainer)&&!X(st().startContainer))return;z(t.startContainer)&&t.startContainer.childNodes.length==1&&q(t.startContainer.firstChild,"br")&&t.startOffset==0&&t.startContainer.removeChild(t.startContainer.firstChild);var n=document.createElement("img");n.setAttribute("src",e),t.insertNode(n),t.setStart(n.parentNode,1+x(n)),t.setEnd(n.parentNode,1+x(n)),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(t),n.removeAttribute("width"),n.removeAttribute("height")}},s.insertlinebreak={action:function(t,n){sn(n,{stripWrappers:!1});if(!V(n.startContainer)&&!X(n.startContainer))return;if(n.startContainer.nodeType==e.Node.ELEMENT_NODE&&!wt("br",n.startContainer))return;if(n.startContainer.nodeType!=e.Node.ELEMENT_NODE&&!wt("br",n.startContainer.parentNode))return;if(n.startContainer.nodeType==e.Node.TEXT_NODE&&n.startOffset==0){var r=n.startContainer.parentNode,i=x(n.startContainer);Aloha.getSelection().collapse(r,i),n.setStart(r,i),n.setEnd(r,i)}if(n.startContainer.nodeType==e.Node.TEXT_NODE&&n.startOffset==T(n.startContainer)){var r=n.startContainer.parentNode,i=1+x(n.startContainer);Aloha.getSelection().collapse(r,i),n.setStart(r,i),n.setEnd(r,i)}var s=document.createElement("br");n.insertNode(s),Aloha.getSelection().collapse(s.parentNode,1+x(s)),n.setStart(s.parentNode,1+x(s)),n.setEnd(s.parentNode,1+x(s)),Q(s)&&(n.insertNode(dn()),Aloha.getSelection().collapse(s.parentNode,1+x(s)),n.setStart(s.parentNode,1+x(s)),n.setEnd(s.parentNode,1+x(s)))}},s.insertorderedlist={action:function(){hn("ol")},indeterm:function(){return/^mixed( ol)?$/.test($t())},state:function(){return $t()=="ol"}},s.insertparagraph={action:function(t,n){sn(n);if(!V(n.startContainer)&&!X(n.startContainer))return;var r=n.startContainer,i=n.startOffset;r.nodeType==e.Node.TEXT_NODE&&i!=0&&
i!=T(r)&&r.splitText(i),r.nodeType==e.Node.TEXT_NODE&&i==T(r)&&(i=1+x(r),r=r.parentNode);if(r.nodeType==e.Node.TEXT_NODE||r.nodeType==e.Node.COMMENT_NODE)i=x(r),r=r.parentNode;Aloha.getSelection().collapse(r,i),n.setStart(r,i),n.setEnd(r,i);var s=r;while(!Ut(s)&&V(s.parentNode)&&K(r,s.parentNode))s=s.parentNode;if(!V(s)||!K(s,r)||!Ut(s)){var o=zt,u=Yt(n),f=L(u,function(e){return wt(e,"p")}).slice(0,1);if(!f.length){if(!wt(o,n.startContainer))return;s=document.createElement(o),n.insertNode(s),s.appendChild(dn()),Aloha.getSelection().collapse(s,0),n.setStart(s,0),n.setEnd(s,0);return}while(f[f.length-1].nextSibling&&wt(f[f.length-1].nextSibling,"p"))f.push(f[f.length-1].nextSibling);s=gt(f,function(){return!1},function(){return document.createElement(o)},n)}if(s.tagName=="ADDRESS"||s.tagName=="LISTING"||s.tagName=="PRE"){var l=document.createElement("br"),c=s.offsetHeight;n.insertNode(l);var h=s.offsetHeight;Aloha.getSelection().collapse(r,i+1),n.setStart(r,i+1),n.setEnd(r,i+1),c==h&&!p(a(l),s)&&(n.insertNode(dn()),Aloha.getSelection().collapse(r,i+1),n.setEnd(r,i+1));return}if(e(["LI","DT","DD"]).indexOf(s.tagName)!=-1&&(!s.hasChildNodes()||s.childNodes.length==1&&q(s.firstChild,"br"))){on([s],n);if(!s.hasChildNodes()){var c=s.offsetHeight,d=dn();s.appendChild(d),s.offsetHeight!==c&&s.removeChild(d)}q(s,["dd","dt"])&&e(m(s)).every(function(e){return!K(s,e)||!wt(s,e)})&&(s=pt(s,zt,n)),Wt(s,n);if(q(s,"li")&&q(s.nextSibling,"li")&&q(s.nextSibling.firstChild,["ol","ul"])){var v=s.nextSibling,y=s.nextSibling.childNodes.length;for(var b=0;b<y;b++)s.appendChild(v.childNodes[b]);v.parentNode.removeChild(v)}return}var w=Aloha.createRange();w.setStart(n.startContainer,n.startOffset),w.setEnd(s,T(s));while(w.startOffset==0&&w.startContainer!=s)w.setStart(w.startContainer.parentNode,x(w.startContainer));while(w.startOffset==T(w.startContainer)&&w.startContainer!=s)w.setStart(w.startContainer.parentNode,1+x(w.startContainer));var E=L(w),S=!E.length||E.length==1&&q(E[0],"br"),N;/^H[1-6]$/.test(s.tagName)&&S?N=zt:s.tagName=="DT"&&S?N="dd":s.tagName=="DD"&&S?N="dt":N=s.tagName.toLowerCase();var C=document.createElement(N);for(var b=0;b<s.attributes.length;b++)typeof C.setAttributeNS=="function"?C.setAttributeNS(s.attributes[b].namespaceURI,s.attributes[b].name,s.attributes[b].value):s.attributes[b].value.length>0&&s.attributes[b].value!="null"&&s.attributes[b].value>0&&C.setAttribute(s.attributes[b].name,s.attributes[b].value);C.removeAttribute("id"),s.parentNode.insertBefore(C,s.nextSibling);var k=A(w),O=w.extractContents(),M=g(O);for(var b=0;b<M.length;b++)M[b].nodeType==e.Node.ELEMENT_NODE&&e(k).indexOf(M[b])==-1&&M[b].removeAttribute("id");var _=[],D=O.firstChild;if(D)do Y(D)||_.push(D);while(D=D.nextSibling);if(q(C,"li")&&_.length&&q(_[0],["ul","ol"])){var c=C.offsetHeight,d=dn();C.appendChild(d);var h=C.offsetHeight;c!==h&&C.removeChild(d)}C.appendChild(O),s.offsetHeight==0&&!e(s.childNodes).some(tt)&&s.appendChild(dn()),C.offsetHeight==0&&!e(C.childNodes).some(tt)&&C.appendChild(dn()),Aloha.getSelection().collapse(C,0),n.setStart(C,0),n.setEnd(C,0)}},s.inserttext={action:function(t,n){sn(n,{stripWrappers:!1});if(!V(n.startContainer)&&!X(n.startContainer))return;if(t.length>1){for(var r=0;r<t.length;r++)s.inserttext.action(t[r],n);return}if(t=="")return;if(t=="\n"){s.insertparagraph.action("",n);return}var i=n.startContainer,o=n.startOffset;0<=o-1&&o-1<i.childNodes.length&&i.childNodes[o-1].nodeType==e.Node.TEXT_NODE&&(i=i.childNodes[o-1],o=T(i)),0<=o&&o<i.childNodes.length&&i.childNodes[o].nodeType==e.Node.TEXT_NODE&&(i=i.childNodes[o],o=0);var u=i.nodeType==e.Node.ELEMENT_NODE?i:i.parentNode;t==" "&&u.nodeType==e.Node.ELEMENT_NODE&&e(["pre","pre-wrap"]).indexOf(e.getComputedStyle(u).whiteSpace)==-1&&(t=" ");var a=tn(n);if(i.nodeType==e.Node.TEXT_NODE)i.insertData(o,t),Aloha.getSelection().collapse(i,o),n.setStart(i,o),Aloha.getSelection().extend(i,o+1),n.setEnd(i,o+1);else{i.childNodes.length==1&&Q(i.firstChild)&&i.removeChild(i.firstChild);var f=document.createTextNode(t);n.insertNode(f),Aloha.getSelection().collapse(f,0),n.setStart(f,0),Aloha.getSelection().extend(f,1),n.setEnd(f,1)}rn(a),fn(n.startContainer,n.startOffset),fn(n.endContainer,n.endOffset),Aloha.getSelection().collapseToEnd(),n.collapse(!1)}},s.insertunorderedlist={action:function(){hn("ul")},indeterm:function(){return/^mixed( ul)?$/.test($t())},state:function(){return $t()=="ul"}},s.justifycenter={action:function(e,t){pn("center",t)},indeterm:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e(t).some(function(e){return Jt(e)=="center"})&&e(t).some(function(e){return Jt(e)!="center"})},state:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return t.length&&e(t).every(function(e){return Jt(e)=="center"})},value:function(){var e=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e.length?Jt(e[0]):"left"}},s.justifyfull={action:function(e,t){pn("justify",t)},indeterm:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e(t).some(function(e){return Jt(e)=="justify"})&&e(t).some(function(e){return Jt(e)!="justify"})},state:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return t.length&&e(t).every(function(e){return Jt(e)=="justify"})},value:function(){var e=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e.length?Jt(e[0]):"left"}},s.justifyleft={action:function(e,t){pn("left",t)},indeterm:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e(t).some(function(e){return Jt(e)=="left"})&&e(t).some(function(e){return Jt(e)!="left"})},state:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return t.length&&e(t).every(function(e){return Jt(e)=="left"})},value:function(){var e=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e.length?Jt(e[0]):"left"}},s.justifyright={action:function(e,t){pn("right",t)},indeterm:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e(t).some(function(e){return Jt(e)=="right"})&&e(t).some(function(e){return Jt(e)!="right"})},state:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return t.length&&e(t).every(function(e){return Jt(e)=="right"})},value:function(){var e=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e.length?Jt(e[0]):"left"}},s.outdent={action:function(){var t=[];(function(){for(var e=st().endContainer;e!=st().commonAncestorContainer;e=e.parentNode)q(e,"li")&&t.unshift(e);for(var e=st().startContainer;e;e=e.parentNode)q(e,"li")&&t.unshift(e)})(),e(t).forEach(function(e){Xt(e,range)});var n=Yt(st()),r=L(n,function(t){return V(t)&&(!e(g(t)).some(V)||q(t,["ol","ul"])||q(t,"li")&&q(t.parentNode,["ol","ul"]))});while(r.length){while(r.length&&(q(r[0],["OL","UL"])||!q(r[0].parentNode,["OL","UL"])))cn(r.shift(),range);if(!r.length)break;var i=[];i.push(r.shift());while(r.length&&r[0]==i[i.length-1].nextSibling&&!q(r[0],["OL","UL"]))i.push(r.shift());var s=Mt(i);on(i,range),e(i).forEach(Wt),_t(s,range)}}},s.selectall={action:function(){var e=document.body;e||(e=document.documentElement),e?Aloha.getSelection().selectAllChildren(e):Aloha.getSelection().removeAllRanges()}},s.stylewithcss={action:function(e){r=String(e).toLowerCase()!="false"},state:function(){return r}},s.usecss={action:function(e){r=String(e).toLowerCase()=="false"}},function(){var t=[];for(var n in s)t.push(n);e(t).forEach(function(t){"relevantCssProperty"in s[t]||(s[t].relevantCssProperty=null),"inlineCommandActivatedValues"in s[t]&&!("indeterm"in s[t])&&(s[t].indeterm=function(n){var r=e(xt(n,function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})).map(function(e){return Lt(e,t)}),i=e(r).filter(function(n){return e(s[t].inlineCommandActivatedValues).indexOf(n)!=-1});return i.length>=1&&r.length-i.length>=1}),"inlineCommandActivatedValues"in s[t]&&(s[t].state=function(n){var r=xt(n,function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE});return r.length==0?e(s[t].inlineCommandActivatedValues).indexOf(Lt(n.startContainer,t))!=-1:e(r).every(function(n){return e(s[t].inlineCommandActivatedValues).indexOf(Lt(n,t))!=-1})}),"standardInlineValueCommand"in s[t]&&(s[t].indeterm=function(){var n=e(xt(st())).filter(function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE},!0).map(function(e){return Lt(e,t)});for(var r=1;r<n.length;r++)if(n[r]!=n[r-1])return!0;return!1},s[t].value=function(n){var r=xt(n,function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0];return typeof r=="undefined"&&(r=n.startContainer),Lt(r,t)})})}(),{commands:s,execCommand:P,queryCommandIndeterm:B,queryCommandState:j,queryCommandValue:I,queryCommandEnabled:H,queryCommandSupported:F}});